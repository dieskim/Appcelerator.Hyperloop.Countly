<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>lib/checkEnableFeatures/checkEnableFeatures.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-activityLoader.html">activityLoader</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-activityLoader.html#~createActivityLoader">createActivityLoader</a></li></ul></li><li><a href="module-alertFormOpenClose.html">alertFormOpenClose</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-alertFormOpenClose.html#~alertFormOpenClose">alertFormOpenClose</a></li><li data-type='method' style='display: none;'><a href="module-alertFormOpenClose.html#~shouldAlertFormBeOnTop">shouldAlertFormBeOnTop</a></li></ul></li><li><a href="module-appPauseResume.html">appPauseResume</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-appPauseResume.html#~appPauseResume">appPauseResume</a></li><li data-type='method' style='display: none;'><a href="module-appPauseResume.html#~isInForegroundCheck">isInForegroundCheck</a></li></ul></li><li><a href="module-checkCountlyURL.html">checkCountlyURL</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkCountlyURL.html#.checkURL">checkURL</a></li><li data-type='method' style='display: none;'><a href="module-checkCountlyURL.html#.getURL">getURL</a></li></ul></li><li><a href="module-checkDownloadURL.html">checkDownloadURL</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-checkDownloadURL.html#.checkDownloadURL">checkDownloadURL</a></li><li data-type='member' style='display: none;'><a href="module-checkDownloadURL.html#.requestStoragePermissions">requestStoragePermissions</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~downloadURL">downloadURL</a></li><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~logStorageError">logStorageError</a></li><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~openSettings">openSettings</a></li></ul></li><li><a href="module-checkEnableFeatures.html">checkEnableFeatures</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#.checkEnableXML">checkEnableXML</a></li><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#.enableDisable">enableDisable</a></li><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#~setiOSDateEnable">setiOSDateEnable</a></li></ul></li><li><a href="module-countlyModule.html">countlyModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.crashTest">crashTest</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.enableDebug">enableDebug</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.getDeviceID">getDeviceID</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordCrashLog">recordCrashLog</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordEvent">recordEvent</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordHandledException">recordHandledException</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordLocation">recordLocation</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordUnhandledException">recordUnhandledException</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.resume">resume</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.start">start</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.stop">stop</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.userData">userData</a></li></ul></li><li><a href="module-crmSendData.html">crmSendData</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmCreateUpdate">crmCreateUpdate</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmLogin">crmLogin</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSearch">crmSearch</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSendData">crmSendData</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSendTask">crmSendTask</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~getSetCRMUserData">getSetCRMUserData</a></li></ul></li><li><a href="module-customForm.html">customForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-customForm.html#.show">show</a></li></ul></li><li><a href="module-getSetFontSize.html">getSetFontSize</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-getSetFontSize.html#~getSetFontSize">getSetFontSize</a></li></ul></li><li><a href="module-locationData.html">locationData</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-locationData.html#.getCurrentLocation">getCurrentLocation</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#.getLocationData">getLocationData</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#~getLocationNow">getLocationNow</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#~logLocationError">logLocationError</a></li></ul></li><li><a href="module-navigationOpenClose.html">navigationOpenClose</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.closeNavigationView">closeNavigationView</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.navigationGoHome">navigationGoHome</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.navigationUpdateData">navigationUpdateData</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.openNavigationView">openNavigationView</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#~navigationOpenCloseView">navigationOpenCloseView</a></li></ul></li><li><a href="module-openLastOpenView.html">openLastOpenView</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-openLastOpenView.html#~openLastOpenView">openLastOpenView</a></li></ul></li><li><a href="module-pushAlert.html">pushAlert</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-pushAlert.html#.pushAlert">pushAlert</a></li><li data-type='method' style='display: none;'><a href="module-pushAlert.html#.showPushXML">showPushXML</a></li><li data-type='method' style='display: none;'><a href="module-pushAlert.html#~pushPopUp">pushPopUp</a></li></ul></li><li><a href="module-reviewDialog.html">reviewDialog</a></li><li><a href="module-scheduleNotifications.html">scheduleNotifications</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#.scheduleLocalNotification">scheduleLocalNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~comeBackToAppNotification">comeBackToAppNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleNotification">scheduleNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleQODNotification">scheduleQODNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleVODNotification">scheduleVODNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~subscribeToNotifactions">subscribeToNotifactions</a></li></ul></li><li><a href="module-sendForm.html">sendForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-sendForm.html#~removeFirstFormFromArray">removeFirstFormFromArray</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~sendFormsFunction">sendFormsFunction</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~storeFormsToSend">storeFormsToSend</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~submitAllForms">submitAllForms</a></li></ul></li><li><a href="module-showFeedbackForm.html">showFeedbackForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~inputArrayItemValue">inputArrayItemValue</a></li><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~sendForm">sendForm</a></li><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~showFeedbackForm">showFeedbackForm</a></li></ul></li><li><a href="module-showForms.html">showForms</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-showForms.html#.showShare">showShare</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadBasic">booksReadBasic</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadComplete">booksReadComplete</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadHalf">booksReadHalf</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.selectedReadingReadComplete">selectedReadingReadComplete</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.showAppHighUsageForm">showAppHighUsageForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.showContact">showContact</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~shareRequestForm">shareRequestForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showBooksReadBasicForm">showBooksReadBasicForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showBooksReadCompleteForm">showBooksReadCompleteForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showSelectedReadingReadCompleteForm">showSelectedReadingReadCompleteForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showShareFunction">showShareFunction</a></li></ul></li><li><a href="module-subscribeForm.html">subscribeForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-subscribeForm.html#~subscribeForm">subscribeForm</a></li></ul></li><li><a href="module-updateApp.html">updateApp</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-updateApp.html#~downloadAlert">downloadAlert</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~downloadUpdate">downloadUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~installAppUpdate">installAppUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~showAndroidNotification">showAndroidNotification</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~updateApp">updateApp</a></li></ul></li><li><a href="module-updateCheck.html">updateCheck</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~appVersionCompare">appVersionCompare</a></li><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~checkUpdate">checkUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~showUpdateForm">showUpdateForm</a></li></ul></li><li><a href="module-vodPrepare.html">vodPrepare</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vodPrepare.html#.vodDataTextPrepare">vodDataTextPrepare</a></li><li data-type='method' style='display: none;'><a href="module-vodPrepare.html#~vodDataPrepare">vodDataPrepare</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="global.html#event:app:showAlertMessage">app:showAlertMessage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Alloy.Globals.AnalyticsDeviceID">Alloy.Globals.AnalyticsDeviceID</a></li><li><a href="global.html#Alloy.Globals.AnalyticsEvent">Alloy.Globals.AnalyticsEvent</a></li><li><a href="global.html#Alloy.Globals.AnalyticsRecordLocation">Alloy.Globals.AnalyticsRecordLocation</a></li><li><a href="global.html#Alloy.Globals.bibleDBTextGenerate">Alloy.Globals.bibleDBTextGenerate</a></li><li><a href="global.html#Alloy.Globals.databaseData">Alloy.Globals.databaseData</a></li><li><a href="global.html#Alloy.Globals.defaultComeBackNotificationDays">Alloy.Globals.defaultComeBackNotificationDays</a></li><li><a href="global.html#Alloy.Globals.defaultNotificationDays">Alloy.Globals.defaultNotificationDays</a></li><li><a href="global.html#Alloy.Globals.defaultNotificationSubscriptions">Alloy.Globals.defaultNotificationSubscriptions</a></li><li><a href="global.html#Alloy.Globals.enableDateDelayedFunctions">Alloy.Globals.enableDateDelayedFunctions</a></li><li><a href="global.html#Alloy.Globals.enableFeaturesDateIOS">Alloy.Globals.enableFeaturesDateIOS</a></li><li><a href="global.html#Alloy.Globals.locationDefault">Alloy.Globals.locationDefault</a></li><li><a href="global.html#Alloy.Globals.openAlertForm">Alloy.Globals.openAlertForm</a></li><li><a href="global.html#Alloy.Globals.openAlertFormArray">Alloy.Globals.openAlertFormArray</a></li><li><a href="global.html#Alloy.Globals.openWindow">Alloy.Globals.openWindow</a></li><li><a href="global.html#Alloy.Globals.qodNotificationTime">Alloy.Globals.qodNotificationTime</a></li><li><a href="global.html#Alloy.Globals.storageDevice">Alloy.Globals.storageDevice</a></li><li><a href="global.html#Alloy.Globals.vodNotificationTime">Alloy.Globals.vodNotificationTime</a></li><li><a href="global.html#databaseUpdateAlert">databaseUpdateAlert</a></li><li><a href="global.html#downloadUpdateDatabases">downloadUpdateDatabases</a></li><li><a href="global.html#updateDatabases">updateDatabases</a></li><li><a href="global.html#VirtualScroller">VirtualScroller</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/checkEnableFeatures/checkEnableFeatures.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * checkEnableFeatures Module
 * - enableDisable checks for automatic (date) enable / previous manual enable
 * - checkEnableXML checks server app_info_xml for manual enable
 *  
 * Alloy.Globals: 
 * - {@link Alloy.Globals.databaseData Alloy.Globals.databaseData}
 * - {@link Alloy.Globals.enableFeaturesDateIOS Alloy.Globals.enableFeaturesDateIOS}
 * - {@link Alloy.Globals.enableDateDelayedFunctions Alloy.Globals.enableDateDelayedFunctions}
 * 
 * @requires   checkDownloadURL
 * @module checkEnableFeatures
 * @example    &lt;caption>Require and enableDisable at Startup&lt;/caption>
 * 	// require checkEnableFeatures
	var checkEnableFeatures = require('checkEnableFeatures/checkEnableFeatures');

	// run checkEnableFeatures.enableDisable
	checkEnableFeatures.enableDisable();
 *  
 * @example    &lt;caption>Require and checkEnableXML after startup (1 second) to check server&lt;/caption>
 * 	// run checkEnableFeatures.checkEnableXML()
	checkEnableFeatures.checkEnableXML();
 * 
 */

/**
 * Sets Alloy.Globals.enableDateDelayedFunctions
 * 
 */
exports.enableDisable = function(){

	// START IF - OS_IOS
	if (OS_IOS){
		
		// START IF - current Date > Alloy.Globals.enableFeaturesDateIOS
		if(new Date() > Alloy.Globals.enableFeaturesDateIOS){
				
			// set Alloy.Globals.enableDateDelayedFunctions true
			Alloy.Globals.enableDateDelayedFunctions = true;
				
		}else{
			
			// get enableFeaturesIOSData 
			var enableFeaturesIOSData = JSON.parse(Ti.App.Properties.getString('enableFeaturesIOS',false));			// Contains: {version: 3.0.1, enabled: true}
			
			Ti.API.info("enableFeaturesIOSData");
			Ti.API.info(enableFeaturesIOSData);
			
			// START IF - enableFeaturesIOS true then check values
			if(enableFeaturesIOSData){
				
				// set enabledVersion and enabledValue
				var enabledVersion = enableFeaturesIOSData.version;
				var enabledValue = enableFeaturesIOSData.enabled;
			
				// set currentVersion as current installed app version
				var currentVersion = Ti.App.version;
				
				// START IF - enabledVersion is currentVersion and enabledValue true
				if(enabledVersion == currentVersion &amp;&amp; enabledValue){
					
					// set Alloy.Globals.enableDateDelayedFunctions true
					Alloy.Globals.enableDateDelayedFunctions = true;
					
				};
				// END IF - enabledVersion is  currentVersion and enabledValue true	

			};
			// END IF - enabledVersion is  currentVersion and enabledValue true		
						
		};
		// START END - current Date > Alloy.Globals.enableFeaturesDateIOS			
		
	}else{	// else Android always true
		Alloy.Globals.enableDateDelayedFunctions = true;
	};
	// END IF - OS_IOS
	
	Ti.API.info("Startup: Alloy.Globals.enableDateDelayedFunctions : " + Alloy.Globals.enableDateDelayedFunctions);

};

/**
 * checks server app_info_xml for manual enable
 *
 */
exports.checkEnableXML = function (){
	
	Ti.API.info("Start - checkXMLiOSDateInfo");
	
	// set appInfoURLArrayString
	var appInfoURLArrayString = databaseConnect({	
							database: Alloy.Globals.databaseData.urlData.databaseName,
							table: "urlData",
							method:"getFieldValue",
							field: "urlList", 
							lookupField: "urlName",
							value: "app_info_xml",
	});
	
	// Require checkDownloadURL module
	var checkDownloadURL = require('checkDownloadURL/checkDownloadURL');
	
	// START - run checkDownloadURL	and check for working URL
	checkDownloadURL.checkDownloadURL({
		urlArrayString: appInfoURLArrayString,						// set appInfoURLArrayString
	    success: function (success) {								// on Success
	        	Ti.API.info("Success - checkXMLAppInfo URL Found");
		        
		        // set foundURL
		        var foundURL = success.foundURL;
		        
				// set httpClient
				var httpClient = Titanium.Network.createHTTPClient();
				
				httpClient.onload = function() {
					
					//Ti.API.info("Module - checkXMLAppInfo Success");
					
					// set data from XML
					var xmlData = this.responseXML.documentElement;
					
					// get app_version_data
					var appVersionsData = xmlData.getElementsByTagName("app_version_data");
					
					// START LOOP - loop through appVersionsData and check
					for (var i=0;i&lt;appVersionsData.length;i++) {
				         
				        // set currentVersion as current installed app version
						var currentVersion = Ti.App.version;
			
				        // set vars
				        var app_version = appVersionsData.item(i).getElementsByTagName("app_version").item(0).textContent;
				        var date_data_enable = appVersionsData.item(i).getElementsByTagName("date_data_enable").item(0).textContent;      
				        
				        Ti.API.info("currentVersion" + currentVersion);
				        Ti.API.info("app_version" + app_version);
				        Ti.API.info("date_data_enable" + date_data_enable);
				         
				        // START IF - app_version = currentVersion check date_data_enable 
				        if (app_version == currentVersion){
				        	
				        	// START IF - date_data_enable true then return true else false
				        	if(date_data_enable == 'true'){
				        		
				        		// run setiOSDateEnable
				        		setiOSDateEnable(true);
				        		
				        	}else{
				        		
								// run setiOSDateEnable
				        		setiOSDateEnable(false);
				        		
				        	};
				        	// END IF - date_data_enable true then return true else false
				        	
				        	// return from function
				        	return;
				        	
				        };		
				        // END IF - app_version = currentVersion check date_data_enable	       
				              
				   	};
			    	// END LOOP - loop through appVersionsData and check
						
					// run setiOSDateEnable
				    setiOSDateEnable(false);
						
				};
				
				httpClient.onerror = function(e) {
					
					// Error - return error
					//Ti.API.info("Module - checkXMLAppInfo Error:" + e.error);
			        
				};   
				                
				httpClient.open('GET', foundURL);
				httpClient.send();
				
			},	    
			error: function (error) {									// on Error
					
				Ti.API.info("Error - All checkXMLAppInfo URLS Failed");		
					             
			},
				
	});
	// END - run checkDownloadURL	and check for working URL
};

/**
 * sets Ti.App.Properties enableFeaturesIOS for future enable checks
 *
 * @param      {boolean}  trueFalse  true to enable / false to disable
 */
function setiOSDateEnable(trueFalse){
		
	//Ti.API.info("checkSetiOSDateEnable trueFalse: " + trueFalse);
	
	// set currentVersion as current installed app version
	var currentVersion = Ti.App.version;	

	// START IF - trueFalse true
	if (trueFalse){
					
		// set Alloy.Globals.enableDateDelayedFunctions true
		Alloy.Globals.enableDateDelayedFunctions = true;
				
		// set enableFeaturesIOSData
		var enableFeaturesIOSData = { 	version: currentVersion,
										enabled: true,	};
					
		// set Ti.App.Properties enableFeaturesIOS
		Ti.App.Properties.setString('enableFeaturesIOS',JSON.stringify(enableFeaturesIOSData));
					
	}else{
					
		// set Alloy.Globals.enableDateDelayedFunctions false
		Alloy.Globals.enableDateDelayedFunctions = false;
					
		// set enableFeaturesIOSData
		var enableFeaturesIOSData = { 	version: currentVersion,
										enabled: false,	};
				
		// set Ti.App.Properties enableFeaturesIOS
		Ti.App.Properties.setString('enableFeaturesIOS',JSON.stringify(enableFeaturesIOSData));
				
	};
	// END IF - trueFalse true
	
	Ti.API.info("setiOSDateEnable End: Alloy.Globals.enableDateDelayedFunctions: " + Alloy.Globals.enableDateDelayedFunctions);
	
};</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>

<script src="scripts/search.js"></script>


<script src="scripts/collapse.js"></script>



</body>
</html>
