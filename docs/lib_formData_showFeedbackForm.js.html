<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>lib/formData/showFeedbackForm.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-activityLoader.html">activityLoader</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-activityLoader.html#~createActivityLoader">createActivityLoader</a></li></ul></li><li><a href="module-alertFormOpenClose.html">alertFormOpenClose</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-alertFormOpenClose.html#~alertFormOpenClose">alertFormOpenClose</a></li><li data-type='method' style='display: none;'><a href="module-alertFormOpenClose.html#~shouldAlertFormBeOnTop">shouldAlertFormBeOnTop</a></li></ul></li><li><a href="module-appPauseResume.html">appPauseResume</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-appPauseResume.html#~appPauseResume">appPauseResume</a></li><li data-type='method' style='display: none;'><a href="module-appPauseResume.html#~isInForegroundCheck">isInForegroundCheck</a></li></ul></li><li><a href="module-checkCountlyURL.html">checkCountlyURL</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkCountlyURL.html#.checkURL">checkURL</a></li><li data-type='method' style='display: none;'><a href="module-checkCountlyURL.html#.getURL">getURL</a></li></ul></li><li><a href="module-checkDownloadURL.html">checkDownloadURL</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-checkDownloadURL.html#.checkDownloadURL">checkDownloadURL</a></li><li data-type='member' style='display: none;'><a href="module-checkDownloadURL.html#.requestStoragePermissions">requestStoragePermissions</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~downloadURL">downloadURL</a></li><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~logStorageError">logStorageError</a></li><li data-type='method' style='display: none;'><a href="module-checkDownloadURL.html#~openSettings">openSettings</a></li></ul></li><li><a href="module-checkEnableFeatures.html">checkEnableFeatures</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#.checkEnableXML">checkEnableXML</a></li><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#.enableDisable">enableDisable</a></li><li data-type='method' style='display: none;'><a href="module-checkEnableFeatures.html#~setiOSDateEnable">setiOSDateEnable</a></li></ul></li><li><a href="module-countlyModule.html">countlyModule</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.crashTest">crashTest</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.enableDebug">enableDebug</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.getDeviceID">getDeviceID</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordCrashLog">recordCrashLog</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordEvent">recordEvent</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordHandledException">recordHandledException</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordLocation">recordLocation</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.recordUnhandledException">recordUnhandledException</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.resume">resume</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.start">start</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.stop">stop</a></li><li data-type='method' style='display: none;'><a href="module-countlyModule.html#.userData">userData</a></li></ul></li><li><a href="module-crmSendData.html">crmSendData</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmCreateUpdate">crmCreateUpdate</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmLogin">crmLogin</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSearch">crmSearch</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSendData">crmSendData</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~crmSendTask">crmSendTask</a></li><li data-type='method' style='display: none;'><a href="module-crmSendData.html#~getSetCRMUserData">getSetCRMUserData</a></li></ul></li><li><a href="module-customForm.html">customForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-customForm.html#.show">show</a></li></ul></li><li><a href="module-getSetFontSize.html">getSetFontSize</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-getSetFontSize.html#~getSetFontSize">getSetFontSize</a></li></ul></li><li><a href="module-locationData.html">locationData</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-locationData.html#.getCurrentLocation">getCurrentLocation</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#.getLocationData">getLocationData</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#~getLocationNow">getLocationNow</a></li><li data-type='method' style='display: none;'><a href="module-locationData.html#~logLocationError">logLocationError</a></li></ul></li><li><a href="module-navigationOpenClose.html">navigationOpenClose</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.closeNavigationView">closeNavigationView</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.navigationGoHome">navigationGoHome</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.navigationUpdateData">navigationUpdateData</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#.openNavigationView">openNavigationView</a></li><li data-type='method' style='display: none;'><a href="module-navigationOpenClose.html#~navigationOpenCloseView">navigationOpenCloseView</a></li></ul></li><li><a href="module-openLastOpenView.html">openLastOpenView</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-openLastOpenView.html#~openLastOpenView">openLastOpenView</a></li></ul></li><li><a href="module-pushAlert.html">pushAlert</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-pushAlert.html#.pushAlert">pushAlert</a></li><li data-type='method' style='display: none;'><a href="module-pushAlert.html#.showPushXML">showPushXML</a></li><li data-type='method' style='display: none;'><a href="module-pushAlert.html#~pushPopUp">pushPopUp</a></li></ul></li><li><a href="module-reviewDialog.html">reviewDialog</a></li><li><a href="module-scheduleNotifications.html">scheduleNotifications</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#.scheduleLocalNotification">scheduleLocalNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~comeBackToAppNotification">comeBackToAppNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleNotification">scheduleNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleQODNotification">scheduleQODNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~scheduleVODNotification">scheduleVODNotification</a></li><li data-type='method' style='display: none;'><a href="module-scheduleNotifications.html#~subscribeToNotifactions">subscribeToNotifactions</a></li></ul></li><li><a href="module-sendForm.html">sendForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-sendForm.html#~removeFirstFormFromArray">removeFirstFormFromArray</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~sendFormsFunction">sendFormsFunction</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~storeFormsToSend">storeFormsToSend</a></li><li data-type='method' style='display: none;'><a href="module-sendForm.html#~submitAllForms">submitAllForms</a></li></ul></li><li><a href="module-showFeedbackForm.html">showFeedbackForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~inputArrayItemValue">inputArrayItemValue</a></li><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~sendForm">sendForm</a></li><li data-type='method' style='display: none;'><a href="module-showFeedbackForm.html#~showFeedbackForm">showFeedbackForm</a></li></ul></li><li><a href="module-showForms.html">showForms</a><ul class='members'><li data-type='member' style='display: none;'><a href="module-showForms.html#.showShare">showShare</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadBasic">booksReadBasic</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadComplete">booksReadComplete</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.booksReadHalf">booksReadHalf</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.selectedReadingReadComplete">selectedReadingReadComplete</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.showAppHighUsageForm">showAppHighUsageForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#.showContact">showContact</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~shareRequestForm">shareRequestForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showBooksReadBasicForm">showBooksReadBasicForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showBooksReadCompleteForm">showBooksReadCompleteForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showSelectedReadingReadCompleteForm">showSelectedReadingReadCompleteForm</a></li><li data-type='method' style='display: none;'><a href="module-showForms.html#~showShareFunction">showShareFunction</a></li></ul></li><li><a href="module-subscribeForm.html">subscribeForm</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-subscribeForm.html#~subscribeForm">subscribeForm</a></li></ul></li><li><a href="module-updateApp.html">updateApp</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-updateApp.html#~downloadAlert">downloadAlert</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~downloadUpdate">downloadUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~installAppUpdate">installAppUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~showAndroidNotification">showAndroidNotification</a></li><li data-type='method' style='display: none;'><a href="module-updateApp.html#~updateApp">updateApp</a></li></ul></li><li><a href="module-updateCheck.html">updateCheck</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~appVersionCompare">appVersionCompare</a></li><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~checkUpdate">checkUpdate</a></li><li data-type='method' style='display: none;'><a href="module-updateCheck.html#~showUpdateForm">showUpdateForm</a></li></ul></li><li><a href="module-vodPrepare.html">vodPrepare</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-vodPrepare.html#.vodDataTextPrepare">vodDataTextPrepare</a></li><li data-type='method' style='display: none;'><a href="module-vodPrepare.html#~vodDataPrepare">vodDataPrepare</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="global.html#event:app:showAlertMessage">app:showAlertMessage</a></li></ul><h3>Global</h3><ul><li><a href="global.html#Alloy.Globals.AnalyticsDeviceID">Alloy.Globals.AnalyticsDeviceID</a></li><li><a href="global.html#Alloy.Globals.AnalyticsEvent">Alloy.Globals.AnalyticsEvent</a></li><li><a href="global.html#Alloy.Globals.AnalyticsRecordLocation">Alloy.Globals.AnalyticsRecordLocation</a></li><li><a href="global.html#Alloy.Globals.bibleDBTextGenerate">Alloy.Globals.bibleDBTextGenerate</a></li><li><a href="global.html#Alloy.Globals.databaseData">Alloy.Globals.databaseData</a></li><li><a href="global.html#Alloy.Globals.defaultComeBackNotificationDays">Alloy.Globals.defaultComeBackNotificationDays</a></li><li><a href="global.html#Alloy.Globals.defaultNotificationDays">Alloy.Globals.defaultNotificationDays</a></li><li><a href="global.html#Alloy.Globals.defaultNotificationSubscriptions">Alloy.Globals.defaultNotificationSubscriptions</a></li><li><a href="global.html#Alloy.Globals.enableDateDelayedFunctions">Alloy.Globals.enableDateDelayedFunctions</a></li><li><a href="global.html#Alloy.Globals.enableFeaturesDateIOS">Alloy.Globals.enableFeaturesDateIOS</a></li><li><a href="global.html#Alloy.Globals.locationDefault">Alloy.Globals.locationDefault</a></li><li><a href="global.html#Alloy.Globals.openAlertForm">Alloy.Globals.openAlertForm</a></li><li><a href="global.html#Alloy.Globals.openAlertFormArray">Alloy.Globals.openAlertFormArray</a></li><li><a href="global.html#Alloy.Globals.openWindow">Alloy.Globals.openWindow</a></li><li><a href="global.html#Alloy.Globals.qodNotificationTime">Alloy.Globals.qodNotificationTime</a></li><li><a href="global.html#Alloy.Globals.storageDevice">Alloy.Globals.storageDevice</a></li><li><a href="global.html#Alloy.Globals.vodNotificationTime">Alloy.Globals.vodNotificationTime</a></li><li><a href="global.html#databaseUpdateAlert">databaseUpdateAlert</a></li><li><a href="global.html#downloadUpdateDatabases">downloadUpdateDatabases</a></li><li><a href="global.html#updateDatabases">updateDatabases</a></li><li><a href="global.html#VirtualScroller">VirtualScroller</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/formData/showFeedbackForm.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * showFeedbackForm
 * - showFeedbackForm build and then sends the feedback from via customForm and sendForm
 *
 * Alloy.Globals: 
 * - {@link Alloy.Globals.AnalyticsUserData Alloy.Globals.AnalyticsUserData}
 * - {@link Alloy.Globals.crmVars Alloy.Globals.crmVars}
 * - {@link Alloy.Globals.crmFromName Alloy.Globals.crmFromName}
 * 
 * @requires   locationData
 * @requires   customForm
 * @requires   sendForm
 * 
 * @module showFeedbackForm 
 * 
 * @example    &lt;caption>Require and run returned function to build and show form and send on confirm&lt;/caption> 
 * 
 * // require module showFeedbackForm in app/assets/lib/
	var showFeedbackForm = require('formData/showFeedbackForm');
    
	// set showFormData			
	var showFormData = {	title: titleString,
							message: L("bookCompleteMessage"),
							confirm: L("bookCompleteConfirm"),
							cancel:  L("cancel"),
							fields: [wechatField,qqField,emailField,optionsField],
							bookName: bookName,
							formName: "booksReadCompleteForm",
						};
	
	// run showFeedbackForm
	showFeedbackForm(showFormData);
 * 
 *
 */


/**
 * Shows the feedback form.
 *
 * @param      {object}  showFormData  The show form data
 * @param      {string}  showFormData.title  The form title
 * @param      {string}  showFormData.message  The form message
 * @param      {string}  showFormData.confirm  The form confirm title
 * @param      {string}  showFormData.cancel  The form cancel title
 * @param      {array}  showFormData.fields  The form fields array
 * @param      {string}  showFormData.bookName  The form book name
 * @param      {string}  showFormData.selectedReadingName  The form selected reading name
 * @param      {string}  showFormData.formName  The form name
 * 
 * @return     {function}  - function to build and show form and send on confirm
 */
function showFeedbackForm(showFormData){
	
	//Ti.API.info("showFeedbackForm");
	
	// set params
	var formTitle = showFormData.title;
	var formMessage = showFormData.message;
	var formConfirm = showFormData.confirm;
	var formCancel = showFormData.cancel;
	var formFields = showFormData.fields;
	var bookName =  showFormData.bookName;
	var selectedReadingName =  showFormData.selectedReadingName;
	var formName = showFormData.formName;
								
	// customForm Dialog with params	
	var notificationData = {
		cancelIndex: 0,
		buttonNames: [formCancel,formConfirm],
		fields: formFields,
		bookName: bookName,
		selectedReadingName: selectedReadingName,
		formName: formName,
		message: formMessage,
		title: formTitle,
		click: function(e){
	
			//START IF - Cancel Clicked close ELSE
		    if (e.index == 0){
		      	Ti.API.info('The Cancel button was clicked');
		      	
		      	// run Countly set UserData		
				Alloy.Globals.AnalyticsUserData();
	
		    }else{
		    	Ti.API.info('The OK button was clicked');
		    	
		    	// set formData
		    	var formData = {	formInput: e.inputData,
		    						bookName: e.bookName,
		    						selectedReadingName: e.selectedReadingName,
		    						formName: e.formName,
		    					};
		    					
		    	// sendForm with formData
		    	
		    	// require locationData module
				var locationData = require('locationData/locationData');
				
				// run locationData.getCurrentLocation
				locationData.getCurrentLocation({ 	locationCaller: formName,
															success: function(){
																
																// run sendForm
																sendForm(formData);
																
															},
															error: function(e){
																
																// run sendForm
																sendForm(formData);
															
															},
				});
	    		
		    	
		    };
		    //END IF - Cancel Clicked close ELSE 	
		},
	};
	
	// require module customForm in app/assets/lib/
	var customForm = require('formData/customForm');
	
	// show customForm notification
	customForm.show(notificationData);

};

/**
 * searches for a key in a array and returns the value if found
 *
 * @param      {array}    arr     The arr
 * @param      {string}   val     the key
 * @return     {string}   returns the value found for array value
 */
function inputArrayItemValue(arr,val) {
	for (var i=0; i&lt;arr.length; i++){
		if (arr[i].name === val) {                    
			return arr[i].value;
		};
	};
	return false;
};

/**
 * Builds and sends the form
 *
 * @param      {object}  formData  The form data
 * @param      {array}  formData.formInput  The form input data array
 * @param      {string}  formData.bookName  The form sent bookName
 * @param      {string}  formData.selectedReadingName  The form sent selected reading name
 * @param      {string}  formData.formName  The form name
 * 
 */
function sendForm(formData){
		
	//Ti.API.info("SendForm Function in feedbackForms Module");
	
	// set params to send to salesforce	      	
	var formParams = {
	    'formName': formData.formName,  
	};
	
	// set lead source
	formParams[Alloy.Globals.crmVars.crmLeadSource] = Alloy.Globals.crmFromName;
	
	// set OUDID and add to formParams
	var OUDID = Alloy.Globals.AnalyticsDeviceID();
	formParams[Alloy.Globals.crmVars.crmOUDID] = OUDID;
	
	// set jpushDeviceID and add to formParams
	var jpushDeviceID = Ti.App.Properties.getString('JPushID','');
	formParams[Alloy.Globals.crmVars.crmJPUSHID] = jpushDeviceID;
	
	// set jpush read group
	var jpushReadGroup = JSON.parse(Ti.App.Properties.getString('jpushReadGroup',false));
	if(jpushReadGroup){
		formParams[Alloy.Globals.crmVars.crmJPUSHReadGroup] = jpushReadGroup;
	};		
		
	// require locationData module
	var locationData = require('locationData/locationData');
	
	// set gpsLocation
	var locationData = locationData.getLocationData("object");		
	
	var locationLatitude = locationData.latitude || '';
	var locationLongitude = locationData.longitude || '';
	
	formParams[Alloy.Globals.crmVars.crmGPSLatitude] = locationLatitude;
	formParams[Alloy.Globals.crmVars.crmGPSLongitude] = locationLongitude;
    
    // set formAppHighUsage
	// get appUsageAmount from Ti.App.Properties
	var appUsageAmount = Ti.App.Properties.getString('appUsageAmount',0);	// string with amount of app usages
	// START IF - Check appUsageAmount and add true if >= Alloy.Globals.highUsageFormAmount
	if (appUsageAmount >= Alloy.Globals.highUsageFormAmount){
		formParams[Alloy.Globals.crmVars.crmAppHighUsage] = true;
	};
	// END IF - Check appUsageAmount and add true if >= Alloy.Globals.highUsageFormAmount

    // set booksReadBasic
    var booksReadBasicArray = JSON.parse(Ti.App.Properties.getString('booksReadBasic','[]'));
	var booksReadBasic = booksReadBasicArray.join(";");
    formParams[Alloy.Globals.crmVars.crmBooksReadBasic] = booksReadBasic;
    
    // set booksReadHalf
    var booksReadHalfArray = JSON.parse(Ti.App.Properties.getString('booksReadHalf','[]'));
	var booksReadHalf = booksReadHalfArray.join(";");
    formParams[Alloy.Globals.crmVars.crmBooksReadHalf] = booksReadHalf;
    
    // set booksReadComplete
    var booksReadCompleteArray = JSON.parse(Ti.App.Properties.getString('booksReadComplete','[]'));	
	var booksReadComplete = booksReadCompleteArray.join(";");
    formParams[Alloy.Globals.crmVars.crmBooksReadComplete] = booksReadComplete;
    
    // set selectedReadingReadComplete
    var selectedReadingReadCompleteArray = JSON.parse(Ti.App.Properties.getString('selectedReadingReadComplete','[]'));	
	var selectedReadingReadComplete = selectedReadingReadCompleteArray.join(";");
    formParams[Alloy.Globals.crmVars.crmSelectedReadingReadComplete] = selectedReadingReadComplete;

    // START IF - formName booksReadBasicForm else booksReadCompleteForm
    if(formData.formName == "booksReadBasicForm"){
    	
    	// get booksBasicWantCalligraphyArray
    	var booksBasicWantCalligraphyArray = JSON.parse(Ti.App.Properties.getString('booksBasicWantCaligraphy','[]'));	// leave Ti.App.Properties booksBasicWantCaligraphy spelling mistake for old apps
    	
    	// set bookInArray - check if bookName in booksBasicWantCalligraphyArray
    	var bookInArray = valueInArray(booksBasicWantCalligraphyArray,formData.bookName);
		
		// START IF - bookInArray
		if (bookInArray){
			//Ti.API.info("Book already in booksBasicWantCalligraphyArray");
		}else{
			
			// add current bookName to booksBasicWantCalligraphyArray
			booksBasicWantCalligraphyArray.push(formData.bookName);
			
			// set booksBasicWantCalligraphy to booksBasicWantCalligraphyArray	
			Ti.App.Properties.setString('booksBasicWantCaligraphy',JSON.stringify(booksBasicWantCalligraphyArray));		// leave Ti.App.Properties booksBasicWantCaligraphy spelling mistake for old apps
					
			// set booksBasicWantCalligraphy
			var booksBasicWantCalligraphy = booksBasicWantCalligraphyArray.join(";");;
			formParams[Alloy.Globals.crmVars.crmBookName] = formData.bookName;
			formParams[Alloy.Globals.crmVars.crmBooksBasicWantCalligraphy] = booksBasicWantCalligraphy;
		
		};
    	// END IF - bookInArray
	
    }else if (formData.formName == "booksReadCompleteForm"){
    	
    	// get booksCompletedFeedbackArray
    	var booksCompletedFeedbackArray = JSON.parse(Ti.App.Properties.getString('booksCompletedFeedback','[]'));	// array of booksCompletedFeedback
    	
    	// set bookInArray - check if bookName in booksBasicWantCalligraphyArray
    	var bookInArray = valueInArray(booksCompletedFeedbackArray,formData.bookName);
		
		// START IF - bookInArray
		if (bookInArray){
			//Ti.API.info("Book already in booksCompletedFeedbackArray");
		}else{
			
			// add current bookName to booksCompletedFeedbackArray
			booksCompletedFeedbackArray.push(formData.bookName);
			
			// set booksBasicWantCalligraphy to booksBasicWantCalligraphyArray	
			Ti.App.Properties.setString('booksCompletedFeedback',JSON.stringify(booksCompletedFeedbackArray));	
					
			// set booksCompletedFeedback
			var booksCompletedFeedback = booksCompletedFeedbackArray.join(";");
			formParams[Alloy.Globals.crmVars.crmBookName] = formData.bookName;
			formParams[Alloy.Globals.crmVars.crmBooksCompletedFeedback] = booksCompletedFeedback;
		
		};
    	// END IF - bookInArray
		
   	}else if (formData.formName == "selectedReadingReadCompleteForm"){
    	
    	// get selectedReadingCompletedFeedbackArray
    	var selectedReadingCompletedFeedbackArray = JSON.parse(Ti.App.Properties.getString('selectedReadingCompletedFeedback','[]'));	// array of selectedReadingCompletedFeedback
    	
    	// set selectedReadingInArray - check if selectedReadingName in selectedReadingCompletedFeedbackArray
    	var selectedReadingInArray = valueInArray(selectedReadingCompletedFeedbackArray,formData.selectedReadingName);
		
		// START IF - selectedReadingInArray
		if (selectedReadingInArray){
			//Ti.API.info("SelectedReading already in selectedReadingCompletedFeedbackArray");
		}else{
			
			// add current selectedReadingName to selectedReadingCompletedFeedbackArray
			selectedReadingCompletedFeedbackArray.push(formData.selectedReadingName);
			
			// set selectedReadingCompletedFeedbackArray to selectedReadingCompletedFeedback	
			Ti.App.Properties.setString('selectedReadingCompletedFeedback',JSON.stringify(selectedReadingCompletedFeedbackArray));	
					
			// set booksCompletedFeedback
			var selectedReadingCompletedFeedback = selectedReadingCompletedFeedbackArray.join(";");
			formParams[Alloy.Globals.crmVars.crmSelectedReadingName] = formData.selectedReadingName;
			formParams[Alloy.Globals.crmVars.crmSelectedReadingCompletedFeedback] = selectedReadingCompletedFeedback;
		
		};
    	// END IF - bookInArray
		
   	};
	// END IF - formName booksReadBasicForm else booksReadCompleteForm  
	
	// set formInput
	var formInput = formData.formInput;
	
	// set wechat	
	var formUserWechat = inputArrayItemValue(formInput,"userWechat") || '';
	formParams[Alloy.Globals.crmVars.crmWechat] = formUserWechat;
	
	// set qq
	var formUserQQ = inputArrayItemValue(formInput,"userQQ") || '';
	formParams[Alloy.Globals.crmVars.crmQQ] = formUserQQ;
	
	// set email
	var formUserEmail = inputArrayItemValue(formInput,"userEmail") || '';
	formParams[Alloy.Globals.crmVars.crmEmail] = formUserEmail;
	
	//set custom comment
	var formCustomComment = inputArrayItemValue(formInput,"customComment") || '';
	formParams[Alloy.Globals.crmVars.crmAppComment] = formCustomComment;
	
	// get bookFeeback
	var bookFeedback = inputArrayItemValue(formInput,"bookFeedback") || '';
	
	// START Loop - through options
	for (var t=0; t&lt;bookFeedback.length; t++){
			
			// get bookFeedbackOptionName and bookFeedbackOptionValue
			var bookFeedbackOptionName = bookFeedback[t].optionName;
			var bookFeedbackOptionValue = bookFeedback[t].value;
			
			// START IF - bookFeedbackOptionValue true
			if (bookFeedbackOptionValue){
				
				// set booksReadCompleteOptionArray as Ti.App.Properties bookFeedbackOptionName
				var booksReadCompleteOptionArray = JSON.parse(Ti.App.Properties.getString(bookFeedbackOptionName,'[]'));	// array of bookFeedbackOptionName
				
				// add current bookName to booksReadCompleteOptionArray
				booksReadCompleteOptionArray.push(formData.bookName);
			
				// set Ti.App.Properties bookFeedbackOptionName to booksReadCompleteOptionArray	
				Ti.App.Properties.setString(bookFeedbackOptionName,JSON.stringify(booksReadCompleteOptionArray));
		
				// convert booksReadCompleteOptionArray to booksReadCompleteOptionString
				var booksReadCompleteOptionString = booksReadCompleteOptionArray.join(";");
				
				// add booksReadCompleteOptionString to formParams bookFeedbackOptionName 
				formParams[bookFeedbackOptionName] = booksReadCompleteOptionString;
				
			};
			// END IF - bookFeedbackOptionValue true
			
	};
	// END Loop - through options	
	
	// get selectedReadingFeedback
	var selectedReadingFeedback = inputArrayItemValue(formInput,"selectedReadingFeedback") || '';
	
	// START Loop - through options
	for (var t=0; t&lt;selectedReadingFeedback.length; t++){
			
			// set selectedReadingFeedbackOptionName
			var selectedReadingFeedbackOptionName = selectedReadingFeedback[t].optionName;
			var selectedReadingFeedbackOptionValue = selectedReadingFeedback[t].value;
			
			if (selectedReadingFeedbackOptionValue){
				
				// set all selectedReading basic strings
				var selectedReadingReadCompleteOptionArray = JSON.parse(Ti.App.Properties.getString(selectedReadingFeedbackOptionName,'[]'));	// array of books basic read
				
				// add current formGroup to selectedReadingReadCompleteOptionArray
				selectedReadingReadCompleteOptionArray.push(formData.selectedReadingName);
			
				// set sendForms to sendFormsArray	
				Ti.App.Properties.setString(selectedReadingFeedbackOptionName,JSON.stringify(selectedReadingReadCompleteOptionArray));
		
				// convert selectedReadingReadCompleteOptionArray to selectedReadingReadCompleteOptionString
				var selectedReadingReadCompleteOptionString = selectedReadingReadCompleteOptionArray.join(";");
				// add to formParams Object 
				formParams[selectedReadingFeedbackOptionName] = selectedReadingReadCompleteOptionString;
				
			};

			
	};
	// END Loop - through options
	
	// get customFeedback
	var customFeedback = inputArrayItemValue(formInput,"customFeedback") || false;
	
	// START IF - customFeedback set the loop
	if(customFeedback){
		
		// START Loop - through options
		for (var t=0; t&lt;customFeedback.length; t++){
			
			// get customFeedbackOptionName and customFeedbackOptionValue
			var customFeedbackOptionName = customFeedback[t].optionName;
			var customFeedbackOptionValue = customFeedback[t].value;
			
			// add customFeedbackOptionValue to formParams customFeedbackOptionName 
			formParams[customFeedbackOptionName] = customFeedbackOptionValue;
			
		};
		// END Loop - through options	
		
	};
	// END IF - customFeedback set the loop
	
	//Ti.API.info((JSON.stringify(formParams)));
	
	// run Countly set UserData		
	Alloy.Globals.AnalyticsUserData();
	
	//require sendForm lib
	var sendFormsFunction = require('formData/sendForm'); 
	
	// send formParams to sendFormsFunction
	sendFormsFunction(formParams);
	
};

module.exports = showFeedbackForm;</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/jquery-3.1.1.min.js"></script>

<script src="scripts/search.js"></script>


<script src="scripts/collapse.js"></script>



</body>
</html>
